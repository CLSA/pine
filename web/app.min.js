"use strict";var cenozo=angular.module("cenozo");cenozo.controller("HeaderCtrl",["$scope","CnBaseHeader",function($scope,CnBaseHeader){CnBaseHeader.construct($scope)}]);cenozoApp.initDescriptionModule=function(module,type){angular.extend(module,{identifier:{parent:{subject:type,column:type+".id"}},name:{singular:"description",plural:"descriptions",possessive:"description's"},columnList:{language:{column:"language.code",title:"Langauge"},value:{title:"Value",align:"left"}},defaultOrder:{column:"language.code",reverse:false}});module.addInputGroup("",{language:{column:"language.code",type:"string",constant:true},value:{title:"Value",type:"text"},previous_description_id:{exclude:true},next_description_id:{exclude:true}});module.addExtraOperation("view",{title:'<i class="glyphicon glyphicon-chevron-left"></i>',classes:"btn-info",operation:function($state,model){model.viewModel.viewPreviousDescription()},isDisabled:function($state,model){return null==model.viewModel.record.previous_description_id}});module.addExtraOperation("view",{title:'<i class="glyphicon glyphicon-chevron-right"></i>',classes:"btn-info",operation:function($state,model){model.viewModel.viewNextDescription()},isDisabled:function($state,model){return null==model.viewModel.record.next_description_id}})};cenozo.factory("CnBaseDescriptionViewFactory",["$state",function($state){return{construct:function(object,type){angular.extend(object,{viewPreviousDescription:function(){$state.go(type+"_description.view",{identifier:this.record.previous_description_id},{reload:true})},viewNextDescription:function(){$state.go(type+"_description.view",{identifier:this.record.next_description_id},{reload:true})}})}}}]);cenozo.directive("cnQnaireNavigator",["CnHttpFactory","$state","$q",function(CnHttpFactory,$state,$q){return{templateUrl:cenozoApp.getFileUrl("pine","qnaire_navigator.tpl.html"),restrict:"E",controller:function($scope){angular.extend($scope,{loading:true,subject:$state.current.name.split(".")[0],currentQnaire:null,currentModule:null,currentPage:null,currentQuestion:null,moduleList:[],pageList:[],questionList:[],viewModule:function(id){$state.go("module.view",{identifier:id},{reload:true})},viewPage:function(id){var action="page.render"==$state.current.name?"render":"view";$state.go("page."+action,{identifier:id},{reload:true})},viewQuestion:function(id){$state.go("question.view",{identifier:id},{reload:true})}});var columnList=[{table:"qnaire",column:"id",alias:"qnaire_id"},{table:"qnaire",column:"name",alias:"qnaire_name"}];if(["module","page","question"].includes($scope.subject)){columnList.push({table:"module",column:"id",alias:"module_id"},{table:"module",column:"rank",alias:"module_rank"},{table:"module",column:"name",alias:"module_name"})}if(["page","question"].includes($scope.subject)){columnList.push({table:"page",column:"id",alias:"page_id"},{table:"page",column:"rank",alias:"page_rank"},{table:"page",column:"name",alias:"page_name"})}if("question"==$scope.subject){columnList.push({table:"question",column:"id",alias:"question_id"},{table:"question",column:"rank",alias:"question_rank"},{table:"question",column:"name",alias:"question_name"})}CnHttpFactory.instance({path:$scope.subject+"/"+$state.params.identifier,data:{select:{column:columnList}}}).get().then(function(response){$scope.currentQnaire={id:response.data.qnaire_id?response.data.qnaire_id:response.data.id,name:response.data.qnaire_name?response.data.qnaire_name:response.data.name};if(["module","page","question"].includes($scope.subject)){$scope.currentModule={id:response.data.module_id,rank:response.data.module_rank,name:response.data.module_name}}if(["page","question"].includes($scope.subject)){$scope.currentPage={id:response.data.page_id,rank:response.data.page_rank,name:response.data.page_name}}if("question"==$scope.subject){$scope.currentQuestion={id:response.data.question_id,rank:response.data.question_rank,name:response.data.question_name}}var promiseList=[CnHttpFactory.instance({path:["qnaire",$scope.currentQnaire.id,"module"].join("/"),data:{select:{column:["id","rank","name"]},modifier:{order:"rank"}}}).query().then(function(response){$scope.moduleList=response.data})];if($scope.currentModule)promiseList.push(CnHttpFactory.instance({path:["module",$scope.currentModule.id,"page"].join("/"),data:{select:{column:["id","rank","name"]},modifier:{order:"rank"}}}).query().then(function(response){$scope.pageList=response.data}));if($scope.currentPage)promiseList.push(CnHttpFactory.instance({path:["page",$scope.currentPage.id,"question"].join("/"),data:{select:{column:["id","rank","name"]},modifier:{order:"rank"}}}).query().then(function(response){$scope.questionList=response.data}));$q.all(promiseList)})}}}]);
