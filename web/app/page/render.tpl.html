<cn-qnaire-navigator ng-if="'page' == model.getSubjectFromState()"></cn-qnaire-navigator>
<div class="utility-view rounded">
  <div class="container-fluid bg-primary rounded-top">
    <h4>
      {{ model.viewModel.record.module_name ?  model.viewModel.record.module_name : 'Loading...' }}
      <div class="pull-right" style="margin-top: -7px;">
        <select class="form-control"
                ng-model="model.renderModel.currentLanguage"
                ng-change="model.renderModel.setLanguage()"
                ng-options="lang.code as lang.name for lang in model.viewModel.record.languageList">
        </select>
      </div>
    </h4>
  </div>
  <div class="progress no-rounding">
    <div class="progress-bar"
         role="progressbar"
         style="width: {{ progress }}%; -webkit-transition: none; transition: none;"
         aria-valuenow="{{ progress }}"
         aria-valuemin="0"
         aria-valuemax="100">{{ progress }}%</div>
  </div>
  <form name="form" novalidate>
    <div ng-if="!isComplete" class="loading spacer" uib-tooltip="Loading&hellip;"></div>
    <div ng-if="isComplete" class="spacer" id="Page{{ model.viewModel.record.rank }}">
      <div class="container-fluid vertical-spacer">
        <span class="text-info"
              ng-bind-html="model.viewModel.record.module_descriptions[model.renderModel.currentLanguage] | cnNewlines"></span>
        <span class="text-info"
              ng-bind-html="model.viewModel.record.descriptions[model.renderModel.currentLanguage] | cnNewlines"></span>
        <div ng-repeat="question in model.renderModel.questionList">
          <hr ng-if="!$first" />
          <div ng-if="'comment' == question.type"
               class="vertical-spacer text-info"
               ng-bind-html="question.descriptions[model.renderModel.currentLanguage] | cnNewlines">
          </div>
          <div ng-if="'comment' != question.type"
               ng-bind-html="question.descriptions[model.renderModel.currentLanguage] | cnNewlines"></div>
          <div class="horizontal-spacer" ng-if="'comment' != question" ng-switch="question.type">
            <div ng-switch-when="boolean">
              <label class="btn btn-default full-width"
                     style="text-align: left; font-style: italic; font-weight: normal"
                     ng-model="model.renderModel.data[question.id].yes"
                     ng-click="model.renderModel.setAnswer( 'boolean', question, 'yes' )"
                     uib-btn-checkbox>
                <i class="glyphicon"
                   ng-class="model.renderModel.data[question.id].yes ? 'glyphicon-check' : 'glyphicon-unchecked'"></i>
                {{ text( 'misc.yes' ) }}
              </label>
              <label class="btn btn-default full-width"
                     style="text-align: left; font-style: italic; font-weight: normal"
                     ng-model="model.renderModel.data[question.id].no"
                     ng-click="model.renderModel.setAnswer( 'boolean', question, 'no' )"
                     uib-btn-checkbox>
                <i class="glyphicon"
                   ng-class="model.renderModel.data[question.id].no ? 'glyphicon-check' : 'glyphicon-unchecked'"></i>
                {{ text( 'misc.no' ) }}
              </label>
            </div>
            <div ng-switch-when="list" ng-repeat="option in question.optionList">
              <div ng-if="'list' != option.extra" ng-class="{ 'col-xs-3 col-slim': null != option.extra }">
                <label class="btn btn-default full-width"
                       style="text-align: left"
                       ng-class="{ 'rounded-bottom-left rounded-top-left': null != option.extra }"
                       ng-model="model.renderModel.data[question.id].selectedOptionList[option.id]"
                       ng-style="{ 'font-style': option.exclusive ? 'italic' : 'normal', 'font-weight': 'normal' }"
                       ng-click="model.renderModel.setAnswer( 'option', question, option )"
                       ng-bind-html="'<i class=\'glyphicon ' + (
                         model.renderModel.data[question.id].selectedOptionList[option.id] ? 'glyphicon-check' : 'glyphicon-unchecked'
                       ) + '\'></i> ' + option.descriptions[model.renderModel.currentLanguage]"
                       uib-btn-checkbox>
                </label>
              </div>
              <div ng-if="'list' == option.extra">
                <label class="btn btn-default full-width"
                       style="text-align: left"
                       class="rounded-bottom-left rounded-top-left"
                       ng-model="model.renderModel.data[question.id].selectedOptionList[option.id]"
                       ng-style="{ 'font-style': option.exclusive ? 'italic' : 'normal', 'font-weight': 'normal' }"
                       ng-click="model.renderModel.addAnswerExtra( question )"
                       ng-bind-html="option.descriptions[model.renderModel.currentLanguage] +
                                     ' <i class=\'glyphicon glyphicon-plus\'></i>'">
                </label>
              </div>
              <div ng-if="null != option.extra" ng-switch="option.extra" ng-class="{ 'col-xs-9 col-slim': 'list' != option.extra }">
                <input type="number"
                       id="value_number"
                       class="form-control rounded-bottom-left rounded-bottom-right"
                       ng-switch-when="number"
                       ng-model="model.renderModel.data[question.id].value_number"
                       cn-change="model.renderModel.setAnswer( 'extra', question, option )"
                       ng-disabled="!model.renderModel.data[question.id].selectedOptionList[option.id]"></input>
                <input type="string"
                       id="value_string"
                       class="form-control rounded-bottom-left rounded-bottom-right"
                       ng-switch-when="string"
                       ng-model="model.renderModel.data[question.id].value_string"
                       cn-change="model.renderModel.setAnswer( 'extra', question, option )"
                       ng-disabled="!model.renderModel.data[question.id].selectedOptionList[option.id]"></input>
                <textarea cn-elastic
                          id="value_text"
                          class="form-control"
                          ng-switch-when="text"
                          ng-model="model.renderModel.data[question.id].value_text"
                          cn-change="model.renderModel.setAnswer( 'extra', question, option )"
                          ng-disabled="!model.renderModel.data[question.id].selectedOptionList[option.id]"></textarea>
                <div ng-switch-when="list" ng-repeat="answerExtra in model.renderModel.data[question.id].answerExtraList">
                  <div class="col-xs-11 col-slim">
                    <input type="string"
                           id="answerExtra{{ answerExtra.id }}"
                           ng-model="answerExtra.value"
                           cn-change="model.renderModel.setAnswerExtra( question, answerExtra )"
                           class="form-control rounded-bottom-left rounded-bottom-right"></input>
                  </div>
                  <button type="button"
                          class="btn btn-danger col-slim col-xs-1"
                          ng-click="model.renderModel.removeAnswerExtra( question, answerExtra )">
                    <i class="glyphicon glyphicon-remove"></i>
                  </button>
                </div>
              </div>
            </div>
            <input ng-switch-when="number"
                   class="form-control"
                   type="number"
                   ng-model="model.renderModel.data[question.id].value"
                   cn-change="model.renderModel.setAnswer( 'value', question )"
                   ng-disabled="model.renderModel.data[question.id].dkna || model.renderModel.data[question.id].refuse"
                   cn-autofocus
                   autocomplete="off">
            </input>
            <input ng-switch-when="string"
                   class="form-control"
                   type="text"
                   ng-model="model.renderModel.data[question.id].value"
                   cn-change="model.renderModel.setAnswer( 'value', question )"
                   ng-disabled="model.renderModel.data[question.id].dkna || model.renderModel.data[question.id].refuse"
                   cn-autofocus
                   autocomplete="off">
            </input>
            <textarea ng-switch-when="text"
                      cn-elastic
                      ng-model="model.renderModel.data[question.id].value"
                      cn-change="model.renderModel.setAnswer( 'value', question )"
                      ng-disabled="model.renderModel.data[question.id].dkna || model.renderModel.data[question.id].refuse"
                      cn-autofocus
                      class="form-control">
            </textarea>
            <div class="btn-group full-width" ng-if="'comment' != question.type">
              <label class="btn btn-default col-xs-6"
                     style="text-align: left; font-style: italic; font-weight: normal"
                     ng-model="model.renderModel.data[question.id].dkna"
                     ng-click="model.renderModel.setAnswer( 'dkna', question )"
                     uib-btn-checkbox>
                <i class="glyphicon"
                   ng-class="model.renderModel.data[question.id].dkna ? 'glyphicon-check' : 'glyphicon-unchecked'"></i>
                {{ text( 'misc.dkna' ) }}
              </label>
              <label class="btn btn-default col-xs-6"
                     style="text-align: left; font-style: italic; font-weight: normal"
                     ng-model="model.renderModel.data[question.id].refuse"
                     ng-click="model.renderModel.setAnswer( 'refuse', question )"
                     uib-btn-checkbox>
                <i class="glyphicon"
                   ng-class="model.renderModel.data[question.id].refuse ? 'glyphicon-check' : 'glyphicon-unchecked'"></i>
                {{ text( 'misc.refuse' ) }}
              </label>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="form-footer text-right rounded-bottom bg-info">
      <div class="btn-group pull-left">
        <button type="button"
                ng-if="'page' == model.getSubjectFromState()"
                ng-disabled="null == model.viewModel.record.previous_page_id"
                ng-click="model.renderModel.renderPreviousPage()"
                class="btn btn-info">
          <i class="glyphicon glyphicon-chevron-left"></i>
        </button>
        <button type="button"
                ng-if="'page' == model.getSubjectFromState()"
                ng-disabled="null == model.viewModel.record.next_page_id"
                ng-click="model.renderModel.renderNextPage()"
                class="btn btn-info">
          <i class="glyphicon glyphicon-chevron-right"></i>
        </button>
        <button type="button"
                ng-if="'response' == model.getSubjectFromState()"
                ng-disabled="!isComplete"
                ng-click="model.renderModel.backup()"
                class="btn btn-default"
                style="width: 12em;">
          <i class="glyphicon glyphicon-chevron-left"></i>
          {{ text( 'misc.previous' ) }}
        </button>
      </div>
      <div class="btn-group">
        <button type="button"
                ng-if="'page' == model.getSubjectFromState()"
                ng-click="model.renderModel.viewPage()"
                class="btn btn-default">
          View Page
        </button>
        <button type="button"
                ng-if="'response' == model.getSubjectFromState()"
                ng-disabled="!isComplete || !model.renderModel.pageComplete"
                ng-click="model.renderModel.proceed()"
                class="btn btn-default"
                style="width: 12em;">
          {{ text( 'misc.next' ) }}
          <i class="glyphicon glyphicon-chevron-right"></i>
        </button>
      </div>
    </div>
  </form>
</div>
