define(["page"].reduce(function(list,name){return list.concat(cenozoApp.module(name).getRequiredFiles())},[]),function(){"use strict";try{var module=cenozoApp.module("respondent",true)}catch(err){console.warn(err);return}angular.extend(module,{identifier:{parent:{subject:"qnaire",column:"qnaire.id"}},name:{singular:"respondent",plural:"respondents",possessive:"respondent's"},columnList:{uid:{column:"participant.uid",title:"Participant"},token:{title:"Token"},response_count:{title:"Responses"},start_datetime:{title:"Start Date",type:"date"},end_datetime:{title:"End Date",type:"date"}},defaultOrder:{column:"participant.uid",reverse:false}});module.addInputGroup("",{participant_id:{column:"respondent.participant_id",title:"Participant",type:"lookup-typeahead",typeahead:{table:"participant",select:'CONCAT( participant.first_name, " ", participant.last_name, " (", uid, ")" )',where:["participant.first_name","participant.last_name","uid"]},isConstant:"view"},token:{title:"Token",type:"string",isExcluded:"add"},start_datetime:{title:"Start Date & Time",type:"datetime",isConstant:true,isExcluded:"add"},end_datetime:{title:"End Date & Time",type:"datetime",isConstant:true,isExcluded:"add"}});module.addExtraOperation("view",{title:"Launch",operation:function($state,model){$state.go("respondent.run",{token:model.viewModel.record.token})}});module.addExtraOperation("view",{title:"Re-schedule Email",operation:function($state,model){model.viewModel.resendMail().finally(function(){if(angular.isDefined(model.viewModel.respondentMailModel))model.viewModel.respondentMailModel.listModel.onList(true)})},help:"This will re-schedule all mail for this respondent. "+"This is useful if mail was never sent or if email settings have changed since email was last scheduled."});cenozo.providers.directive("cnRespondentAdd",["CnRespondentModelFactory",function(CnRespondentModelFactory){return{templateUrl:module.getFileUrl("add.tpl.html"),restrict:"E",scope:{model:"=?"},controller:function($scope){if(angular.isUndefined($scope.model))$scope.model=CnRespondentModelFactory.root}}}]);cenozo.providers.directive("cnRespondentList",["CnRespondentModelFactory",function(CnRespondentModelFactory){return{templateUrl:module.getFileUrl("list.tpl.html"),restrict:"E",scope:{model:"=?"},controller:function($scope){if(angular.isUndefined($scope.model))$scope.model=CnRespondentModelFactory.root}}}]);cenozo.providers.directive("cnRespondentRun",["CnRespondentModelFactory",function(CnRespondentModelFactory){return{templateUrl:module.getFileUrl("run.tpl.html"),restrict:"E",scope:{model:"=?"},controller:function($scope){if(angular.isUndefined($scope.model))$scope.model=CnRespondentModelFactory.root}}}]);cenozo.providers.directive("cnRespondentView",["CnRespondentModelFactory",function(CnRespondentModelFactory){return{templateUrl:module.getFileUrl("view.tpl.html"),restrict:"E",scope:{model:"=?"},controller:function($scope){if(angular.isUndefined($scope.model))$scope.model=CnRespondentModelFactory.root}}}]);cenozo.providers.factory("CnRespondentAddFactory",["CnBaseAddFactory",function(CnBaseAddFactory){var object=function(parentModel){CnBaseAddFactory.construct(this,parentModel);this.transitionOnSave=function(record){parentModel.transitionToViewState(record)}};return{instance:function(parentModel){return new object(parentModel)}}}]);cenozo.providers.factory("CnRespondentListFactory",["CnBaseListFactory",function(CnBaseListFactory){var object=function(parentModel){CnBaseListFactory.construct(this,parentModel)};return{instance:function(parentModel){return new object(parentModel)}}}]);cenozo.providers.factory("CnRespondentViewFactory",["CnBaseViewFactory","CnHttpFactory",function(CnBaseViewFactory,CnHttpFactory){var object=function(parentModel,root){var self=this;CnBaseViewFactory.construct(this,parentModel,root,"response");this.resendMail=function(){return CnHttpFactory.instance({path:this.parentModel.getServiceResourcePath()+"?action=resend_mail"}).patch()}};return{instance:function(parentModel,root){return new object(parentModel,root)}}}]);cenozo.providers.factory("CnRespondentModelFactory",["CnBaseModelFactory","CnRespondentAddFactory","CnRespondentListFactory","CnRespondentViewFactory","CnHttpFactory",function(CnBaseModelFactory,CnRespondentAddFactory,CnRespondentListFactory,CnRespondentViewFactory,CnHttpFactory){var object=function(root){var self=this;CnBaseModelFactory.construct(this,module);this.addModel=CnRespondentAddFactory.instance(this);this.listModel=CnRespondentListFactory.instance(this);this.viewModel=CnRespondentViewFactory.instance(this,root)};return{root:new object(true),instance:function(){return new object(false)}}}])});
