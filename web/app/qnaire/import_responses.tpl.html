<div class="utility-view rounded">
  <div class="container-fluid bg-primary rounded-top">
    <h4>
      <div class="pull-right">
        <i class="glyphicon glyphicon-question-sign glyph-hover btn-primary btn-header"
           ng-class="{'glyph-disabled':!model.parentModel.module.hasNotation()}"
           ng-if="model.parentModel.isRole('administrator') || model.parentModel.module.hasNotation()"
           uib-tooltip="Click to view documentation"
           tooltip-placement="left"
           ng-click="model.parentModel.showNotation(); $event.stopPropagation()"></i>
      </div>
      Import Responses for "{{ model.qnaireName }}"
    </h4>
  </div>
  <form name="form" class="form-horizontal" novalidate>
    <div class="form-body container-fluid">
      <div class="container-fluid text-info">
        <div class="vertical-spacer">
          This utility allows you to import response data for the <strong>{{ model.qnaireName }}</strong>
          questionnaire.  In order to proceed you must provide a CSV file containing each response in a row with
          all answers in a separate column named after the question.
        </div>
        <div class="vertical-spacer">
          Note that any question which has no column will automatically be set to "Don't Know/No Anwser".
          If the question does not allow this option then the answer will be left empty.
        </div>
        <div class="vertical-spacer">
          Note that CSV files should be UTF-8 encoded.
        </div>
      </div>
      <hr />
      <div class="form-body">
        <div class="form-group">
          <label for="name" class="control-label col-sm-2">Import CSV File</label>
          <div class="col-sm-10">
            <input
              id="name"
              class="col-sm-10 form-control"
              type="file"
              ng-model="model.file"
              cn-upload="model.file"
              onchange="angular.element(this).scope().model.checkImport()"
              ng-disabled="model.working"
              ng-required="true"></input>
          </div>
        </div>
      </div>
      <div ng-if="null != model.confirmData">
        <div class="panel panel-default">
          <div class="panel-heading">
            <strong>Confirm responses</strong>
          </div>
          <div class="container-fluid panel-body">
            <div class="spacer">
              <h4>Total Pre-existing Responses: {{ model.confirmData.existing_responses }}</h4>
            </div>
            <div ng-if="0 < model.confirmData.invalid_column_list.length" class="spacer">
              <h4>Invalid Columns</h4>
              <div class="container-fluid">
                <div class="text-warning">
                  These invalid columns were found in the CSV file and will be ignored:
                </div>
                <code class="horizontal-spacer">{{ model.confirmData.invalid_column_list.join( ", " ) }}</code>
              </div>
            </div>
            <div ng-if="0 < model.confirmData.missing_column_list.length" class="spacer">
              <h4>Invalid Columns</h4>
              <div class="container-fluid">
                <div class="text-warning">
                  These missing columns were not found in the CSV file so all answers will be left blank:
                </div>
                <code class="horizontal-spacer">{{ model.confirmData.missing_column_list.join( ", " ) }}</code>
              </div>
            </div>
            <div ng-if="0 < model.confirmData.row_errors.length" class="spacer">
              <h4>Row Errors</h4>
              <div class="container-fluid">
                <div class="text-warning">The following row-based errors were detected:</div>
                <div
                  class="text-warning horizontal-spacer"
                  ng-repeat="error in model.confirmData.row_errors"
                  ng-bind-html="error"
                ></div>
              </div>
            </div>
            <div ng-if="0 < model.confirmData.column_errors.length" class="spacer">
              <h4>Column Errors</h4>
              <div class="container-fluid">
                <div class="text-warning">The following column-based errors were detected:</div>
                <div class="horizontal-spacer" ng-repeat="error in model.confirmData.column_errors">
                  <code ng-bind-html="error.column"></code>
                  <div class="text-warning horizontal-spacer" ng-repeat="row in error.rows" ng-bind-html="row"></div>
                </div>
              </div>
            </div>
            <hr />
            <div class="spacer text-info">
              If you wish to proceed you may click the "Import Responses" button below.
            </div>
          </div>
          <div class="form-footer text-right rounded-bottom bg-info">
            <button type="button"
                    class="btn btn-primary"
                    ng-disabled="model.working"
                    cn-really-message="Are you sure you wish to import the responses?"
                    ng-click="model.proceed()">{{ model.working ? 'Working...' : 'Import Responses' }}</button>
          </div>
        </div>
      </div>
    </div>
  </form>
</div>
